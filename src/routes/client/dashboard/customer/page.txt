<script>
	/** @type {import('./$types').PageData} */
	import { supabaseClient } from '$lib/supabase';
	import { onMount } from 'svelte';
	import SidebarCustomer from './SidebarCustomer.svelte';
	import { BarsSolid} from 'flowbite-svelte-icons';
	import {fade} from 'svelte/transition';
	import { Button, Modal } from 'flowbite-svelte';
	import { ExclamationCircleOutline } from 'flowbite-svelte-icons';
	let popupModal = false;
	let sidebarOpen = false;

	let userData;
	/**
	 * @type {any}
	 */
	let customerData;
	let user_id;

	onMount(async () => {
		console.log('im here start');
		customerData = await fetchCustomerData();
		console.log(customerData);
	});

	async function fetchCustomerData() {
		const userLog = await supabaseClient.auth.getUser();
		user_id = userLog.data.user?.id;
		console.log('im here');

		const { data, error } = await supabaseClient
			.from('Customer')
			.select('*')
			.eq('user_id', user_id);

		if (error) {
			console.error('Error fetching customer name: ', error);
		} else if (data && data.length > 0) {
			customerData = data[0];
			console.log('enter');
		}
		return customerData;
	}

	async function toggleSidebar(){
		sidebarOpen = !sidebarOpen;
	}

	async function deleteOrderItem() {
		alert('Delete successful');
	}

	//export let data;
</script>

<div class="titleBarTop">
	<h1>Hi, Shopper.</h1>
</div>
<div class="topSpace"></div>
<div class="titleBarSub">
	<sh1> What will your next order be? </sh1>
</div>

<div class="wrap">
	<button on:click={toggleSidebar}>
		<BarsSolid/>
	</button>
	{#if sidebarOpen}
		<SidebarCustomer/>
	{/if}
</div>

/*Test*/
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>
<div class="topSpace"></div>

<style>
	.titleBarTop {
		font-weight: bold;
		font-size: 24px;
		color: white;
		position: fixed;
		top: 0;
		left: 20;
		width: 100%;
		height: 36px;
		background-color: orange;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.titleBarSub {
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		font-size: 16px;
		color: white;
		position: fixed;
		top: 70;
		left: 0;
		width: 100%;
		height: 20px;
		background-color: orange;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.topSpace {
		top: 0;
		left: 20;
		width: 100%;
		height: 35px;
	}

	.wrap {
		position: fixed;
		height: 100%;
		padding: 20px 0;
        overflow: hidden;
	}
</style>
